<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dzkj.mapper.param_set.PointMapper">

    <select id="queryByGroupId" resultType="com.dzkj.entity.param_set.Point" parameterType="java.lang.Long">
        select pt.*, pg.name as ptGroupName from point pt
        left join pt_group pg on pt.pt_group_id = pg.id
        where pt.pt_group_id = #{groupId}
        order by pt.seq
    </select>

    <select id="queryByMissionId" resultType="com.dzkj.entity.param_set.Point" parameterType="java.lang.Long">
        select pt.*, pg.name as ptGroupName from point pt
        inner join pt_group pg on pt.pt_group_id = pg.id
        inner join pro_mission pm on pg.mission_id = pm.id
        where pm.id = #{missionId}
        order by pt.seq
    </select>

    <select id="getIdInProject" resultType="com.dzkj.biz.dashoborad.vo.StatisticTempData">
        select pt.id as pointId, pj.id as projectId, pj.type_id as typeId from point pt
        inner join pt_group pg on pt.pt_group_id = pg.id
        inner join pro_mission pm on pg.mission_id = pm.id
        inner join project pj on pj.id = pm.project_id
        where pj.id in
        <foreach collection="list" index="index" item="item"
                 separator="," open="(" close=")">
            #{item}
        </foreach>
        order by pt.seq
    </select>

    <select id="queryByMissionIds" resultType="com.dzkj.entity.param_set.Point">
        select pt.*, pg.name as ptGroupName from point pt
        inner join pt_group pg on pt.pt_group_id = pg.id
        inner join pro_mission pm on pg.mission_id = pm.id
        where pm.id in
        <foreach collection="list" index="index" item="item"
                 separator="," open="(" close=")">
            #{item}
        </foreach>
        order by pt.seq
    </select>

    <select id="listPoint" resultType="com.dzkj.entity.param_set.Point">
        select pt.id, pt.name, pt.type
        from point pt
        inner join pt_group pg on pt.pt_group_id = pg.id
        inner join pro_mission pm on pg.mission_id = pm.id
        where pm.id = #{missionId}
          and pt.id not in (
            select pp.point_id from push_point pp where pp.push_task_id = #{pushTaskId} and pp.point_id!= #{pointId}
          )
        order by pt.seq
    </select>

    <select id="listPointJn" resultType="com.dzkj.entity.param_set.Point">
        select pt.id, pt.name, pt.type
        from point pt
                 inner join pt_group pg on pt.pt_group_id = pg.id
                 inner join pro_mission pm on pg.mission_id = pm.id
        where pm.id = #{missionId}
          and pt.id not in (
            select pp.point_id from push_point_jn pp where pp.push_task_id = #{pushTaskId} and pp.point_id!= #{pointId}
        )
        order by pt.seq
    </select>
</mapper>
