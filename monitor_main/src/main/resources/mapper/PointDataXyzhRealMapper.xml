<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dzkj.mapper.data.PointDataXyzhRealMapper">

    <select id="getList" resultType="com.dzkj.biz.data.vo.PointDataXyzhRealVO">
        select pdzr.id, pdzr.pid, pdzr.name, pdzr.stop, pdzr.status, pdzr.recycle_num,
               pdzr.x, pdzr.y, pdzr.z, pdzr.p, pdzr.s, pdzr.t, pdzr.get_time, pdzr.note,
               pg.name as groupName, pm.name as missionName, pj.name as projectName
        from point_data_xyzh_real pdzr
        left join point p on p.id = pdzr.pid
        left join pt_group pg on pg.id = p.pt_group_id
        left join pro_mission pm on pm.id = pg.mission_id
        left join project pj on pj.id = pm.project_id
        where pm.id = #{cond.missionId}
        and pg.id in
        <foreach collection="cond.groupIds" index="index" item="item"
                 separator="," open="(" close=")">
            #{item}
        </foreach>
        <if test="cond.createTime != null">
            and pdzr.get_time <![CDATA[ >= ]]> #{cond.createTime}
        </if>
        order by pdzr.get_time desc
    </select>

    <select id="getPage" resultType="com.dzkj.biz.data.vo.PointDataXyzhRealVO">
        select pdzr.id, pdzr.pid, pdzr.name, pdzr.stop, pdzr.status, pdzr.recycle_num,
               pdzr.x, pdzr.y, pdzr.z, pdzr.p, pdzr.s, pdzr.t, pdzr.get_time, pdzr.note,
               pg.name as groupName, pm.name as missionName, pj.name as projectName
        from point_data_xyzh_real pdzr
        left join point p on p.id = pdzr.pid
        left join pt_group pg on pg.id = p.pt_group_id
        left join pro_mission pm on pm.id = pg.mission_id
        left join project pj on pj.id = pm.project_id
        where pm.id = #{cond.missionId}
        and pg.id in
        <foreach collection="cond.groupIds" index="index" item="item"
                 separator="," open="(" close=")">
            #{item}
        </foreach>
        <if test="cond.createTime != null">
            and pdzr.get_time <![CDATA[ >= ]]> #{cond.createTime}
        </if>
        order by pdzr.get_time desc
    </select>

    <select id="getDataByPidList" resultType="com.dzkj.biz.data.vo.PointDataXyzhRealVO">
        select pdzr.id, pdzr.pid, pdzr.name, pdzr.x, pdzr.y, pdzr.z
        from point_data_xyzh_real pdzr
        inner join
            ( select pid, max(get_time) as max_get_time
                 from point_data_xyzh_real
                 where pid in
                    <foreach collection="list" index="index" item="item"
                             separator="," open="(" close=")">
                        #{item}
                    </foreach>
                   group by pid) temp
        on temp.pid = pdzr.pid and temp.max_get_time = pdzr.get_time
    </select>
</mapper>
